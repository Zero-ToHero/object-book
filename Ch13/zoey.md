# 13. 서브클래싱과 서브타이핑

- 상속의 용도
    - 타입 계층을 구현한다 → 일차적 목표
        - 부모클래스와 자식클래스를 강하게 결합시키기 때문에 설계의 변경과 진화를 방해한다
        - 타입 계층을 목표로 상속을 사용하면 다형적으로 동작하는 객체들의 관계에 기반해 확장 가능하고 유연한 설계를 얻을 수 있게 된다.
    - 코드 재사용

## 타입

- 우리가 인식하는 객체들에 적용하는 개념이나 아이디어

## 타입 계층

- 일반화 : 다른 타입을 완전히 포함하거나 내포하는 타입을 식별하는 행위
- 특수화 : 다른 타입안에 전체적으로 포함되거나 완전히 내포되는 타입을 식별하는 행위
- 슈퍼타입
    - 집합이 다른 집합의 모든 멤버를 포함한다
    - 타입 정의가 다른 타입보다 좀 더 일반적이다
- 서브타입
    - 집합에 포함되는 인스턴스들이 더 큰 집합에 포함된다
    - 타입 정의가 다른 타입보다 좀 더 구체적이다
- 퍼블릭 인터페이스 : 일반적인 타입과 구체적인 타입 간의 관계를 형성하는 기준
- 서브타입의 인스턴스는 수퍼타입의 인스턴스로 간주될 수 있다.

## 서브클래싱과 서브타이핑

- 상속을 이용해서 타입 계층을 구현한다는 것은 부모클래스가 슈퍼타입의 역할을 자식클래스가 서브타입의 역할을 수행하도록 클래스 사이의 관계를 정의한다는 것을 의미한다.

### 상속을 사용해야 하는 경우

- 상속관계가 is-a 관계를 모델링하는가?
    - 자식클래스는 부모클래스라고 할 수 있는 경우
- 클라이언트 입장에서 부모 클래스의 타입으로 자식클래스를 사용해도 무방한가?
    - 상속 계층을 사용하는 클라이언트의 입장에서 부모 클래스와 자식클래스의 차이점을 몰라야 한다.
    - 클라이언트가 두 타입이 동일하게 행동할 것이라고 기대한다면 두 타입을 타입 계층으로 묶을 수 있다.
- 위의 두 질문에 모두 yes일때

### 서브클래싱, 서브타이핑

- 상속을 사용하는 목적으로 나뉜다
- 서브클래싱(subclassing): 다른 클래스의 코드를 재사용할 목적으로 상속을 사용하는 경우
    - 자식 클래스의 인스턴스가 부모 클래스의 인스턴스를 대체할 수 없다. 서브클 래싱을 구현 상속(implementation inheritance) 또는 클래스 상속(class inheritance)이라고 부르기도 한다.
- 서브타이핑(subtyping)
    - 타입 계층을 구성하기 위해 상속을 사용하는 경우
    - 영화 예매 시스템에서 구현한 DiscountPolicy 상속 계층이 서브타이핑에 해당한다.
    - 서브타이핑에서는 자식 클래스와 부모 클래스의 행동이 호환되기 때문에 자식 클래스의 인스턴스가 부모 클래스의 인스턴스를 대체할 수 있다.
    - 이때 부모 클래스는 자식 클래스의 슈퍼타 입이 되고 자식 클래스는 부모 클래스의 서브타입이 된다. 서브타이핑을 인터페이스 상속(interface inheritance)이라고 한다.

## 리스코프 치환 원칙

- 서브타입은 그것의 기반 타입에 대해 대체 가능해야 한다.
- 차이점을 인식하지 못한 채 기반 클래스의 인터페이스를 통해 서브 클래스를 사용할 수 있어야 한다.
- 클라이언트 관점에서 행동이 호환되는 경우에만 자식 클래스가 부모 클래스 대신 사용될 수 있다.

### 클라이언트와 대체 가능성

- 대체 가능성을 결정하는 것은 클라이언트다.

### 리스코프 치환 원칙은 유연한 설계의 기반이다

- 클라이언트 입장에서 퍼블릭 인터페이스의 행동방식이 변경되지 않는다면 클라이언트의 코드를 변경하지 않고도 새로운 자식 클래스와 협력할 수 있게 된다.
- 자식 클래스가 클라이언트의 관점에서 부모 클래스를 대체할 수 있다면 기능 확장을 위해 자식 클래스를 추가하더라도 코드를 수정할 필요가 없어진다. 따라서 리스코프 치환 원칙은 개방-폐쇄 원칙을 만족하는 설계를 위한 전제 조건이다.

## 계약에 의한 설계와 서브 타이핑

- 계약에 의한 설계 : 클라이언트와 서버 사이의 협력
    - 사전조건 (precondition) : 클라이언트가 정상적으로 메서드를 실행하기 위해 만족 시켜야함
    - 사후조건 (postcondition) : 메서드가 실행된 후에 서버가 클라이언트에게 보장해야 함
    - 클래스 불변식 : 메서드 실행전과 실행 후에 인스턴스가 만족 시켜야 함
- 서브타입이 리스코프 치환원칙을 만족시키기 위해서는 클라이언트와 슈퍼타입 간에 체결된 ‘계약’을 준수해야 한다.

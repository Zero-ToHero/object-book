# 14. 일관성 있는 협력
- 객체지향 설계의 목표 : 적절한 책임을 수행하는 객체들의 협력을 기반으로 결합도가 낮고  재사용 가능한 코드 구조를 창조하는 것
- 가능하면 유사한 기능을 구현하기 위해 유사한 협력 패턴을 사용하라
- 일관성 있는 협력 패턴을 적용하면 코드가 이해하기 쉽고 직관적이며 유연해진다.

### 일관성 없는 코드가 가지는 문제점

- 새로운 구현이 추가되면 추가될 수록 코드사이의 일관성이 어긋난다.
- 코드를 이해하기 어렵다.

### 유사한 기능을 서로 다른 방식으로 구현해서는 안된다

- 유지보수 가능한 시스템을 구축하는 첫 걸음은 협력을 일관성 있게 만드는 것이다.

## 설계에 일관성 부여하기

- 협력을 일관성 있게 만들기 위한 지침
    - 변하는 개념을 변하지 않는 개념으로부터 분리하라
        - 변하는 개념을 별도의 서브타입으로 분리한 후 서브타입들을 클라이언트로부터 캡슐화했다.
    - 변하는 개념을 캡슐화하라
        - 추상화에 의존하도록 만들어야 한다.

### 클래스 분리 기준

- 변경의 이유와 주기
    - 클래스는 단 하나의 이유에 의해서마 변경돼야 하고, 클래스 안의 모든 코드는 함께 변경돼야 한다. (SRP원칙을 따르도록 클래스를 분리해야한다)

### 캡슐화

- 캡슐화는 단순히 데이터를 감추는 것이 아니다. 소프트웨어 안에서 변할 수 있는 모든 개념을 감추는 것이다.
    - 즉 캡슐화란 변화는 어떤 것이든 감추는 것이다.
- 객체의 퍼블릭 인터페이스와 구현을 분리하는 것
    - 자주 변경되는 내부 구현을 퍼블릭 인터페이스 뒤로 숨기는 것이다.
- 객체 캡슐화  = 합성
    - Movie 클래스는 DiscountPolicy 타입의 인스턴스 변수 discountPolicy를 포함한다
- 서브타입 캡슐화 = 다형성
    - Movie는 DiscountPolicy에 대해서는 알고 있지만 AmountDiscountPolicy와 PercentDiscountPolicy에 대해서는 알지 못한다.
- 협력을 일관성 있게 만들기 위해 가장 일반적으로 사용하는 방법
    - 서브타입 캡슐화와 객체 캡슐화를 조합하는 것
    - 변하는 부분이 변하지 않는 부분의 서브타입으로 만드는 방법 (타입계층 만들기)
        - 변하지 않는 부분으로부터 변하는 부분을 분리한다 → 변하는 부분들의 공통적인 행동을 추상 클래스나 인터페이스로 추상화 → 변하는 부분들이 추상클래스나 인터페이스를 상속받게 만든다
    - 변하지 않는 부분의 일부로 타입 계층을 합성한다
        - 타입 계층을 변하지 않는 부분에 합성한다. 의존성 주입과 같이 결합도를 느슨하게 유지할 수 있는 방법을 이용해서 오직 추상화에만 의존하게 만들어야 한다.
        - Movie가 DiscountPolicy를 합성 관계로 연결하고 생성자를 통해 의존성을 해결한 방법

### 캡슐화

- 규칙 - 변하지 않는 것, 조건 - 변하는 것
    - 변하지 않는 부분으로부터 변하는 부분을 분리하고
        - FeeCondition의 서브타입
    - 추상화를 합성관계로 연결한다
        - FeeRule은 추상화인 FeeCondition에 대해서만 의존하기 때문에 적용조건이 변하더라도 영향을 받지 않는다.

### 협력패턴 설계

- 애플리케이션에서 유사한 기능에 대한 변경이 지속적으로 발생하고 있다면 변경을 캡슐화 할 수 있는 적절한 추상화를 찾은 후, 이 추상화에 변하지 않는 공통적인 책임을 할당하라
- 현재의 구조가 변경을 캡슐화하기에 적합하지 않다면 코드를 수정하지 않고도 원하는 변경을 수용할 수 있도록 협력과 코드를 리팩터링 하라
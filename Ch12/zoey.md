# 다형성

###

- 목표 : 포함 다형성의 관점에서 런타임에 상속 계층 안에서 적절한 메서드를 선택하는 방법을 이해하는 것

## 다형성

- 다형성
    - 유니버설 다형성
        - 매개변수 (Parametric) : 제네릭 프로그래밍, 클래스의 인스턴스 변수나 메서드의 매개변수 타입을 임의의 타입으로 선언한 수 사용하는 시점에 구체적인 타입으로 지정하는 방식
        - 포함(Inclusion) : 서브타입 다형성, 메세지가 동일하더라도 수신한 객체의 타입에 따라 실제로 수행되는 행동이 달라진다. 상속을 사용해서 구현할 수 있다.
    - 임시 다형성(Ad hoc)
        - 오버로딩
        - 강제 : 자동 형변환을 이용해 동일한 연산자를 다양한 타입에 사용할 수 있는 방식
- 상속의 진정한 목적은 코드 재사용이 아니라 다형성을 위한 서브타입 계층을 구축하는 것이다.

## 상속의 양면성

### 상속 메커니즘을 이해하는 데 필요한 개념

- 업캐스팅
- 동적 메서드 탐색
- 동적 바인딩
- self 참조
- super 참조

### 데이터 관점의 상속

- 데이터 관점에서 상속은 자식 클래스의 인스턴스 안에 부모 클래스의 인스턴스를 포함하는 것으로 볼 수 있다.

### 행동 관점의 상속

- 행동관점의 상속은 부모클래스가 정의한 일부 메서드를 자식클래스의 메서드로 포함 시키는 것
    - 런타임에 시스템이 자식 클래스에 정의되지 않은 메서드가 있을 경우 이 메서드를 부모 클래스 안에서 탐색하므로 부모 클래스에서 구현한 메서드를 자식클래스의 인스턴스에서 수행할 수 있다.
- 객체의 경우 서로 다른 상태를 저장할 수 있도록 각 인스턴스 별로 독립적인 메모리를 할당받아야 한다.
- 하지만 메서드의 경우에는 동일한 클래스의 인스턴스끼리 공유가 가능하기 떄문에 클래스는 한 번만 메모리에 로드하고 각 인스턴스별로 클래스를 가리키는 포인터를 갖게 하는 것이 경제적이다.

- 각 객체는 자신의 클래스를 가리키는 class 포인터를 이용해서 자신의 클래스 정보에 접근할 수 있다.
- 자식클래스의 인스턴스를 통해 부모 클래스에 정의된 메서드를 실행하는 방법
    - 메시지를 수신한 객체는 class 포인터로 연결된 자신의 클래스에서 적절한 메서드가 존재하는지 찾음
    - 메서드가 존재하지 않으면 클래스의 parent 포인터를 따라서 부모 클래스를 차례대로 이동하면서 적절한 메서드가 존재하는지 검색한다.
- 따라서, 각 객체에 포함된 class 포인터와 클래스에 포함된 parent 포인터를 조합하면 현재 인스턴스의 클래스에서 최상위 부모 클래스까지 모든 부모 클래스에 접근하는 것이 가능하다.

## 업캐스팅과 동적 바인딩

### 같은 메시지, 다른 메서드

- 코드 안에서 선언된 참조 타입과 무관하게 실제로 메시지를 수신하는 객체의 타입에 따라 실행되는 메서드가 달라질 수 있는 것은 업캐스팅과 동적 바인딩이 작용해서이다.
    - 업캐스팅 : 부모클래스 타입으로 선언된 변수에 자식 클래스 인스턴스를 할당하는 것이 가능하다.
        - 업캐스팅으로 미래의 자식 클래스들도 협력에 참여할 수 있으므로 유연하고 확장이 용이하다.
    - 동적 바인딩 : 선언된 변수의 타입이 아니라 메세지를 수신하는 객체의 타입에 따라 실행되는 메서드가 결정된다. 객체지향 시스템이 메시지를 처리할 메서드를 런타입에 결정하기 떄문이다.
        - 컴파일 타임 바인딩 : 정적바인딩, 초기바인딩, 호출될 함수를 컴파일 타임에 결정한다.
        - 동적 바인딩 : 지연바인딩, 실행될 메서드를 런타임에 결정하는 방식

## 동적 메서드 탐색과 다형성

- 동적 메서드 탐색
    - 자식클래스가 이해 불가한 메세지를 전송 받은 경우 상속 계층을 따라 부모 클래스에게 처리를 위임한다.
    - 메세지를 수신했을때 실제로 어떤 메서드가 실행될것인지는 실행시점에 이뤄지며, 메서드 탐색 경로는 self 참조를 이용해서 결정한다.
- super vs self
    - super 전송은 부모 클래스에서부터 메서드 탐색을 시작하게 한다
        - 부모 클래스에서 원하는 메러드를 찾지 못한다면 더 상위의 부모 클래스로 이동하면서 메서드가 존재하는지 검사한다.
    - self 전송에서 메시지 탐색을 시작하는 클래스는 실행 시점에 동적으로 결정되는 반면, super 전송의 경우에는 컴파일 시점에 해당 클래스의 부모클래스로 미리 결정할 수 있다.

## 상속 대 위임

### 위임과 self 참조

- self 참조는 항상 메시지를 수신한 객체를 가리킨다.
    - 메서드 탐색 중에는 자식 클래스의 인스턴스와 부모 클래스의 인스턴스가 동일한 self 참조를 공유하는 것으로 봐도 무방
- 위임 : 자신이 수신한 메시지를 다른 객체에게 동일하게 전달해서 처리를 요청하는 것
    - 자신이 정의하지 않거나 처리할 수 없는 속성 또는 메서드의 탐색 과정을 다른 객체로 이동 시키기 위해 사용한다. → 이를 위해 위임은 항상 현재의 실행 문맥을 가리키는 self 참조를 인자로 전달한다.